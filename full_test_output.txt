/Users/alvaro1/Library/Python/3.9/lib/python/site-packages/pytest_asyncio/plugin.py:217: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))
============================= test session starts ==============================
platform darwin -- Python 3.9.6, pytest-8.3.5, pluggy-1.6.0
rootdir: /Users/alvaro1/Documents/Coral/Code/flujo/flujo
configfile: pyproject.toml
plugins: hypothesis-6.141.1, logfire-3.25.0, xdist-3.8.0, timeout-2.4.0, dash-3.2.0, cov-6.2.1, asyncio-0.26.0, anyio-4.9.0
asyncio: mode=auto, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 1710 items

tests/unit/application/test_executor_backend_factories.py ..             [  0%]
tests/unit/application/test_runner_shutdown.py .F                        [  0%]
tests/unit/architect/states/test_plan_approval_state.py .                [  0%]
tests/unit/architect/states/test_planning_state.py .                     [  0%]
tests/unit/architect/states/test_refinement_state.py F                   [  0%]
tests/unit/architect/states/test_validation_state.py .                   [  0%]
tests/unit/architect/test_builtins_analyze_project.py ..                 [  0%]
tests/unit/architect/test_builtins_estimate_plan_cost.py .               [  0%]
tests/unit/architect/test_builtins_run_pipeline_in_memory.py .           [  0%]
tests/unit/architect/test_builtins_visualize_plan.py ..                  [  0%]
tests/unit/architect/test_fallbacks.py .                                 [  0%]
tests/unit/architect/test_planner_agent_toggle.py .                      [  0%]
tests/unit/architect/test_tool_matcher_resilience.py ..                  [  1%]
tests/unit/architect/test_yaml_writer_and_finalize.py ..                 [  1%]
tests/unit/aros/test_cli_health_check_export.py ....                     [  1%]
tests/unit/aros/test_cli_health_check_trend_stage_specific.py .          [  1%]
tests/unit/aros/test_enum_and_stage0.py ....                             [  1%]
tests/unit/aros/test_factory_gpt5_profile.py sssss                       [  1%]
tests/unit/aros/test_grammar_enforcement.py ss                           [  2%]
tests/unit/aros/test_policy_gpt4o_mini.py s                              [  2%]
tests/unit/aros/test_policy_response_format_precedence.py s              [  2%]
tests/unit/aros/test_policy_structured_output_enable.py sssssss          [  2%]
tests/unit/aros/test_processing_config_validation.py ....                [  2%]
tests/unit/aros/test_reasoning_precheck.py .                             [  2%]
tests/unit/aros/test_reasoning_precheck_max_tokens.py .                  [  2%]
tests/unit/aros/test_runner_completion_gate.py FF                        [  3%]
tests/unit/aros/test_schema_derivation.py ..                             [  3%]
tests/unit/aros/test_smart_coercion.py ..............                    [  4%]
tests/unit/aros/test_smart_coercion_anyof.py .                           [  4%]
tests/unit/aros/test_structured_finalize_normalization.py FF             [  4%]
tests/unit/aros/test_tracing_aggregation.py ..                           [  4%]
tests/unit/aros/test_wrapper_kwargs_response_format.py F                 [  4%]
tests/unit/aros/test_wrapper_structured_output.py FFF.                   [  4%]
tests/unit/aros/test_wrapper_unexpected_behavior.py .                    [  4%]
tests/unit/as_step/test_context_merge.py FF                              [  4%]
tests/unit/blueprint/test_loader_pipeline_name.py .                      [  4%]
tests/unit/blueprints/test_agentic_loop_output_template.py F             [  4%]
tests/unit/blueprints/test_agentic_loop_sugar.py F                       [  4%]
tests/unit/blueprints/test_condition_error_messages.py ..                [  5%]
tests/unit/blueprints/test_conditional_bool_branches.py .                [  5%]
tests/unit/blueprints/test_expression_conditions.py ..                   [  5%]
tests/unit/blueprints/test_expression_sandbox.py .....                   [  5%]
tests/unit/blueprints/test_loop_state_sugar.py .                         [  5%]
tests/unit/blueprints/test_loop_state_target_resolution.py ......        [  5%]
tests/unit/blueprints/test_template_resolution.py .....                  [  6%]
tests/unit/builtins/test_builtins_adapters.py ...                        [  6%]
tests/unit/builtins/test_transforms.py ....                              [  6%]
tests/unit/cli/test_fix_va8.py ..                                        [  6%]
tests/unit/cli/test_validate_baseline.py ..                              [  6%]
tests/unit/cli/test_validate_fail_on_warn.py ..                          [  7%]
tests/unit/cli/test_validate_rules_overrides.py .                        [  7%]
tests/unit/cli/test_validate_telemetry_counts.py .                       [  7%]
tests/unit/domain/validation/test_comment_suppress_and_file.py .         [  7%]
tests/unit/domain/validation/test_import_source_file.py .                [  7%]
tests/unit/domain/validation/test_rules_agents_missing.py ...            [  7%]
tests/unit/domain/validation/test_rules_context_isolation.py .........   [  7%]
tests/unit/domain/validation/test_rules_context_missing.py ...           [  8%]
tests/unit/domain/validation/test_rules_exception_linter.py ......s...   [  8%]
tests/unit/domain/validation/test_rules_imports_missing.py ...           [  8%]
tests/unit/domain/validation/test_rules_orchestration_missing.py ..      [  9%]
tests/unit/domain/validation/test_rules_schema_missing.py ..             [  9%]
tests/unit/domain/validation/test_rules_templates_missing.py ..          [  9%]
tests/unit/domain/validation/test_v_cf1_infinite_loop.py ..              [  9%]
tests/unit/domain/validation/test_validation_new_features.py ......