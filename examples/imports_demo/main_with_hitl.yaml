version: "0.1"
imports:
  clarification: "clarification.yaml"
  human_review: "review.yaml"
  concept_discovery: "concept_discovery.yaml"
  query_builder: "query_builder.yaml"

steps:
  - kind: step
    name: clarification
    uses: imports.clarification
    updates_context: true
    config:
      input_to: initial_prompt
      outputs:
        - { child: scratchpad.cohort_definition, parent: scratchpad.cohort_definition }

  - kind: step
    name: human_review
    uses: imports.human_review
    updates_context: true
    config:
      input_to: scratchpad
      outputs:
        - { child: scratchpad.cohort_definition, parent: scratchpad.cohort_definition }

  - kind: step
    name: concept_discovery
    uses: imports.concept_discovery
    updates_context: true
    config:
      input_to: scratchpad
      outputs:
        - { child: scratchpad.concept_sets, parent: scratchpad.concept_sets }

  - kind: step
    name: query_builder
    uses: imports.query_builder
    updates_context: true
    config:
      input_to: scratchpad
      outputs:
        - { child: scratchpad.final_sql, parent: scratchpad.final_sql }
