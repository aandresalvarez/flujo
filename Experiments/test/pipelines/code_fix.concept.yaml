pipeline:
  name: code-fix
  provider: openai_default
  controller:
    type: ordinal
    ordinal:
      tournament_k: 5
      max_frontier: 12
      stop_rules:
        min_support: 2
  hitl:
    mode: gate
  steps:
    - plan:
        prompt: "Summarize failing tests; propose three patch paths."
    - retrieve:
        tools: [code.read_repo]
        with:
          paths: ["src/", "tests/"]
    - act:
        tool: code.apply_patch
        args_from: plan
    - verify:
        fn: Experiments.test.app.verifiers.run_pytests
    - hitl:
        when:
          step: verify
        show: ["patch_diff", "pytest_report"]
        options: ["Apply", "Revise", "Cancel"]
    - save:
        what: [patch, test_report]
